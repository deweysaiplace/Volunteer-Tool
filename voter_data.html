<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voter Data Viewer</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #0f172a; color: #f8fafc; padding: 1rem; margin:0;}
        table { width: 100%; border-collapse: collapse; margin-top: 1rem; font-size: 0.8rem; background: #1e293b; }
        th, td { padding: 0.5rem; border: 1px solid #334155; text-align: left; }
        th { background: #064e3b; color: #f59e0b; position: sticky; top: 0; }
        #loading { text-align: center; color: #f59e0b; font-weight: bold; margin-top: 2rem; }
        .btn-back { background: none; border: none; color: #f59e0b; font-size: 1rem; cursor: pointer; font-weight: 900; margin-bottom: 1rem; text-decoration: none; display: inline-block;}
        .controls { display: flex; justify-content: space-between; align-items: center; margin-top: 1rem; }
        .btn { background: #f59e0b; color: #000; border: none; padding: 0.5rem 1rem; border-radius: 4px; font-weight: bold; cursor: pointer; }
        .btn:disabled { background: #334155; color: #94a3b8; cursor: not-allowed; }
        input[type="text"] { width: 100%; padding: 0.8rem; margin-top: 1rem; border-radius: 4px; border: 1px solid #334155; background: #1e293b; color: white; font-family: 'Inter', sans-serif;}
    </style>
</head>
<body>
    <a href="index.html" class="btn-back">&#8592; BACK TO DASHBOARD</a>
    <h2 style="color:var(--gold);">Raw Voter Data</h2>
    <input type="text" id="search-input" placeholder="Search by name or street..." onkeyup="handleSearch()">
    
    <div id="loading">Loading Data...</div>

    <table id="data-table" style="display:none;">
        <thead id="table-head"></thead>
        <tbody id="table-body"></tbody>
    </table>

    <div class="controls" id="pagination" style="display:none;">
        <button class="btn" id="btn-prev" onclick="prevPage()">Previous</button>
        <span id="page-info">Page 1</span>
        <button class="btn" id="btn-next" onclick="nextPage()">Next</button>
    </div>

    <script>
        let allRows = [];
        let filteredRows = [];
        let headers = [];
        let currentPage = 1;
        const rowsPerPage = 50;

        fetch('data/Coffee_County_Voters_Master.csv')
            .then(response => response.text())
            .then(csvText => {
                const lines = csvText.split('\n').filter(r => r.trim());
                if (lines.length === 0) return;
                
                headers = lines[0].split(',');
                const thead = document.getElementById('table-head');
                thead.innerHTML = '<tr>' + headers.map(h => `<th>${h.replace(/(^"|"$)/g, '')}</th>`).join('') + '</tr>';
                
                for (let i = 1; i < lines.length; i++) {
                    const rowText = lines[i];
                    // Simple split handling quotes
                    let cols = [];
                    let inQuotes = false;
                    let val = '';
                    for (let c = 0; c < rowText.length; c++) {
                        let char = rowText[c];
                        if (char === '"') inQuotes = !inQuotes;
                        else if (char === ',' && !inQuotes) { cols.push(val); val = ''; }
                        else val += char;
                    }
                    cols.push(val);
                    allRows.push(cols);
                }
                filteredRows = allRows;
                document.getElementById('loading').style.display = 'none';
                document.getElementById('data-table').style.display = 'table';
                document.getElementById('pagination').style.display = 'flex';
                renderTable();
            })
            .catch(err => {
                document.getElementById('loading').innerText = 'Error loading CSV data: ' + err;
            });

        function renderTable() {
            const tbody = document.getElementById('table-body');
            let html = '';
            const startIndex = (currentPage - 1) * rowsPerPage;
            const endIndex = Math.min(startIndex + rowsPerPage, filteredRows.length);
            
            for (let i = startIndex; i < endIndex; i++) {
                html += '<tr>' + filteredRows[i].map(c => `<td>${c}</td>`).join('') + '</tr>';
            }
            tbody.innerHTML = html;
            
            document.getElementById('page-info').innerText = `Page ${currentPage} of ${Math.ceil(filteredRows.length / rowsPerPage)}`;
            document.getElementById('btn-prev').disabled = currentPage === 1;
            document.getElementById('btn-next').disabled = currentPage === Math.ceil(filteredRows.length / rowsPerPage);
        }

        function prevPage() { if (currentPage > 1) { currentPage--; renderTable(); window.scrollTo(0,0); } }
        function nextPage() { if (currentPage < Math.ceil(filteredRows.length / rowsPerPage)) { currentPage++; renderTable(); window.scrollTo(0,0); } }

        function handleSearch() {
            const q = document.getElementById('search-input').value.toLowerCase();
            if (!q) {
                filteredRows = allRows;
            } else {
                filteredRows = allRows.filter(row => row.some(col => col.toLowerCase().includes(q)));
            }
            currentPage = 1;
            renderTable();
        }
    </script>
</body>
</html>
